<?php
session_start();
ob_start();
include_once('../include/connection.php');
include_once('../include/data.php');

$data = new Article();
if(isset($_SESSION['logged_in'])){
    
    if($_GET['drop']=="logout")
    {
        session_destroy();
        header('Location:admin.php');
    }
    if($_GET['drop']=="upload")
        header('Location:upload.php');
    if($_GET['drop']=="permission")
        header('Location:permission.php');
    if($_GET['drop']=="changepass")
        header('Location:profile.php');
 $article = $data->fetch_data($_SESSION['username']);
    if(isset($_POST['change'])){
            $query = $pdo->prepare('select * from user where username = ? and password = ?');
            $query->bindValue(1, $_SESSION['username']);
            $query->bindValue(2, md5($_POST['password']));
            $query->execute();
            $row = $query->rowCount();
            if($row == 1){
                if($_POST['password1'] == $_POST['password2'] and $_POST['password1'] != ""){
                    $query = $pdo->prepare('UPDATE user
                                            SET password = ?
                                            WHERE username= ?');
                    $query->bindValue(1, md5($_POST['password1']));
                    $query->bindValue(2, $_SESSION['username']);
                    $query->execute();
                }
            }else{
                echo "Old password is Incorrect :(";
            }

    }
?>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>


<style>
/* unvisited link */
a:link {
    color: #000000;
}

/* visited link */
a:visited {
    color: #0000FF;
}   

/* mouse over link */
a:hover {
    color: #FF00FF;
}

/* selected link */
a:active {
    color: #FF00FF;
}
ul.this li{
    float:left;
}li img{
    border-radius: 150px;
}
</style>


<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link href="http://s3.amazonaws.com/codecademy-content/courses/ltp/css/shift.css" rel="stylesheet">
    
    <link rel="stylesheet" href="http://s3.amazonaws.com/codecademy-content/courses/ltp/css/bootstrap.css">
    <link rel="stylesheet" href="main.css">
    
<title>My-Classmate</title>
</head>

<body link="#000000">
<div class="nav">
      <div class="container">
        <ul class="pull-left">
          <li class="active"><a href="myclassmate.php">Home</a></li>
          <li><a href="#">Status</a></li>
          <li><a href="#">Class</a></li>
        </ul>
        <ul class="pull-right col-lg-5 this">
            <?php if(! $_SESSION['logged_in']){?>

          <li><a href="register.php">Sign Up</a></li>
          
            <?php } ?>
          <?php if($_SESSION['logged_in']){?>
          <li><a href="#"><img src="<?php echo $article['photo']; ?>" width="100"></a></li><?php } ?>
          <li>
            <?php
            if(isset($_SESSION['logged_in'])){
          ?>
          <form action="Myclassmate.php" method='get'>
                        <select onchange='this.form.submit();' name ='drop'>
                            
                                <option value="user"style="background:url(<?php echo $article['photo']; ?>);">
                                     <?php echo $_SESSION["username"]; ?></option>
                                <option value="upload">
                                    Upload Files</option>
                                <option value="logout">
                                    Log out</option>
                                <option value="permission">
                                    Permission</option>
                                    <option value="changepass">
                                    Edit Profile</option>     
                                                         
                        </select>
                    </form>
                    <?php }
                    else{ ?><a href="admin.php">Log In</a></li><?php }?> 

          <li><a href="#">Help</a></li>
        </ul>
      </div>
</div>
<div>   
    <form action="profile.php" method="post"autocomplete="off" >
        
        Enter Old Password:<input type = "password" name="password" placeholder="GivenByAdmin"><br/>                   
        Enter New Password:<input type = "password" name="password1" placeholder=""><br/>
        Re-enter Password:<input type = "password" name="password2" placeholder=""><br/>               
                        
                        
        <input type="submit" value="Change" name='change'/>
     </form>


</div>  
</body>
</html>
<?php }
else{
header('Location:admin.php');
}
?>